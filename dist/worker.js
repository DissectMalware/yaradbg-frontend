var worker;(()=>{if("function"==typeof importScripts){function e(e,t){let r=0,i=[],s=null,o=function(e){let t=[],r=e,n=!1,i=!1,s=null;for(let e=0;e<r.length;e++){if(s=r[e].split(/[ ,]/),"chr"==s[0])n=s[1].startsWith("?")?0:240,i=s[1].endsWith("?")?0:15,s[1]=parseInt(s[1].replace("?","0"),16),s.push(i|n);else if("chrc"==s[0])for(let e=1;e<s.length;e++)s[e]=parseInt(s[e],16);else"jmp"==s[0]?s[1]=l(e,s[1]):s[0].startsWith("split")?(s[1]=l(e,s[1]),s[2]=l(e,s[2])):"ignore"==s[0]&&(s[1]=parseInt(s[1]),s[2]=parseInt(s[2]));t.push(s)}return t}(t);"chr"==o[0][0]&&o[0][1];let a=[];for(let e=0;e<10;e++)a.push({pc:0,priority:0});let p=performance.now();for(;r<e.length;)s=n(e,o,r,a),null!=s?(r=s.start+1,i.push(s)):r+=1;return(performance.now()-p).toString(),i}function t(e,t,r){let n=null;return 0!=e.length?(n=e.pop(),n.pc=t,n.priority=r):n={pc:t,priority:r},n}function r(e,t){e.push(...t),t.length=0}function n(e,n,l,s){let o=[];o.push(t(s,0,0));let a=[],p=0,c=null,u=null,h=!1,f=null,g=[],d=null,y=!1;for(let _=l;_<e.length;_++){y=!1;for(let r=0;r<o.length&&0==y;r++)switch(p=o[r].pc,u=n[p],c=u[0],c){case"chr":if(h=0==u[2]||u[1]==(e[_]&u[2]),!1===h){if(0==g.length)break;d=g.pop(),_=d.end,p=d.ignore_loc,d.end-=1,d.start<=d.end&&g.push(d)}i(a,t(s,p+1,o[r].priority));break;case"chrc":let n=1+(e[_]>>3),c=1<<(7&e[_]);if(h=0!=(u[n]&c),!1===h){if(0==g.length)break;d=g.pop(),_=d.end,p=d.ignore_loc,d.end-=1,d.start<=d.end&&g.push(d)}a.push(t(s,p+1,o[r].priority));break;case"ignore":-1==u[2]&&(u[2]=e.length),g.push({start:_+u[1]-1,end:_+u[2]-1,ignore_loc:p}),_=_+u[1]-1,i(a,t(s,p+1,o[r].priority));break;case"splitjmp":i(o,t(s,u[1],o[r].priority)),i(o,t(s,u[2],o[r].priority+1));break;case"splitstay":case"split":i(o,t(s,u[1],o[r].priority+1)),i(o,t(s,u[2],o[r].priority));break;case"jmp":i(o,t(s,u[1],o[r].priority));break;case"match":(null==f||f.end<_-1)&&(f={start:l,end:_-1,match:!0}),y=!0}if(0==a.length){if(null!=f)return f;r(s,o);break}r(s,o),o=a,a=[]}return f}function i(e,t){e.push(t);let r=e.length-1;for(let t=e.length-2;t>=0&&e[r].priority<e[t].priority;t--){let n=e[r];e[r]=e[t],e[t]=n,r=t}}function l(e,t){let r=t;return t.startsWith("[")?(r=t.substr(1,t.length-2),r=parseInt(r)+e):r=parseInt(r),r}self.importScripts("operators.js"),self.onmessage=function(t){let r=t.data,n=1;r.rules.forEach((function(t,i){try{let t=function(t,r,n){let i={strings:new Map,condition:[]},l=r.get(n);return"undefiend"!=typeof l.string&&function(t,r,n){let i=null;for(let e=0;e<t.length;e++)n.set(t[e].str_name.slice(1),[]);for(const l in t){let s=t[l];if("hex_exp_bytecode"==s.type||"regex_expression_bytecode"==s.type){if(i=e(r,s.val),null!=i)for(let e=0;e<i.length;e++)n.get(s.str_name.slice(1)).push({string:s,start:i[e].start,end:i[e].end})}else if("literal_string"==s.type){let t=!1,l=!1,o=!1;for(let e=0;e<s.modifiers.length;e++)switch(s.modifiers[e].modifier){case"nocase":t=!0;break;case"ascii":l=!0;break;case"wide":o=!0}0==o&&(l=!0);let a=[];s.val=s.val.substr(1,s.val.length-2);for(let e=0;e<s.val.length;e++)a.push(`chr ${s.val.charCodeAt(e).toString(16)}`);if(a.push("match"),i=e(r,a),null!=i)for(let e=0;e<i.length;e++)n.get(s.str_name.slice(1)).push({string:s,start:i[e].start,end:i[e].end})}}}(l.string,t,i.strings),"undefiend"!=typeof l.condition&&operators.eval_condition(t,l.condition,r,i),i}(r.file,r.rules,i);t.rule_name=i,t.hex_editor_id=r.hex_editor_id,t.completed_rules_count=n,t.active_rules_count=r.rules.size,self.postMessage(t)}catch(e){console.log(`Error processing: ${i}`)}n+=1}))}}worker={}})();