var worker;(()=>{if("function"==typeof importScripts){function e(e){let t=null,r=0;for(let n=0;n<e.length;n++)e[n].startsWith("chr")&&(t=e[n].split(" "),r=parseInt(t[1],16),r>=65&&r<=90&&(r|=32),t[1]=r.toString(16),e[n]=t.join(" "))}function t(e){let t=[];e=(e=(e=(e=(e=e.replaceAll("\\\\","\\")).replaceAll("\\n","\n")).replaceAll("\\r","\r")).replaceAll("\\t","\t")).replaceAll('\\"','"');for(let r=0;r<e.length;r++)t.push(`chr ${e.charCodeAt(r).toString(16)}`);return t.push("match"),t}function r(e){let t={no_case:!1,ascii:!1,wide:!1};for(let r=0;r<e.length;r++)switch(e[r].modifier){case"nocase":t.no_case=!0;break;case"ascii":t.ascii=!0;break;case"wide":t.wide=!0}return 0==t.wide&&(t.ascii=!0),t}function n(e,t,r,n=!1){let l=0,i=[],o=null,a=function(e){let t=[],r=e,n=!1,l=!1,i=null;for(let e=0;e<r.length;e++){if(i=r[e].split(/[ ,]/),"chr"==i[0])n=i[1].startsWith("?")?0:240,l=i[1].endsWith("?")?0:15,i[1]=parseInt(i[1].replace("?","0"),16),i.push(l|n);else if("chrc"==i[0])for(let e=1;e<i.length;e++)i[e]=parseInt(i[e],16);else"jmp"==i[0]?i[1]=c(e,i[1]):i[0].startsWith("split")?(i[1]=c(e,i[1]),i[2]=c(e,i[2])):"ignore"==i[0]&&(i[1]=parseInt(i[1]),i[2]=parseInt(i[2]));t.push(i)}return t}(t);"chr"==a[0][0]&&a[0][1];let p=[];for(let e=0;e<10;e++)p.push({pc:0,priority:0});let u=performance.now();for(;l<e.length-1;)o=s(e,a,l,p,r,n),null!=o?(l=o.start+1,i.push(o)):l+=1;return(performance.now()-u).toString(),i}function l(e,t,r){let n=null;return 0!=e.length?(n=e.pop(),n.pc=t,n.priority=r):n={pc:t,priority:r},n}function i(e,t){e.push(...t),t.length=0}function s(e,t,r,n,s,c=!1){let a=[];a.push(l(n,0,0));let p=[],u=0,h=null,f=null,g=!1,d=null,_=[],y=null,m=!1,b=c?2:1,w=null;for(let k=r;k<e.length-1;k+=b){m=!1,w=e[k],s&&w>=65&&w<=90&&(w|=32);for(let i=0;i<a.length&&0==m;i++)switch(u=a[i].pc,f=t[u],h=f[0],h){case"chr":if(g=0==f[2]||f[1]==(w&f[2]),g&&c&&0!=e[k+1]&&(g=!1),!1===g){if(0==_.length)break;y=_.pop(),k=y.end,u=y.ignore_loc,y.end-=1,y.start<=y.end&&_.push(y)}o(p,l(n,u+1,a[i].priority));break;case"chrc":let t=1+(e[k]>>3),s=1<<(7&e[k]);if(g=0!=(f[t]&s),!1===g){if(0==_.length)break;y=_.pop(),k=y.end,u=y.ignore_loc,y.end-=1,y.start<=y.end&&_.push(y)}p.push(l(n,u+1,a[i].priority));break;case"ignore":-1==f[2]&&(f[2]=e.length),_.push({start:k+f[1]-1,end:k+f[2]-1,ignore_loc:u}),k=k+f[1]-1,o(p,l(n,u+1,a[i].priority));break;case"splitjmp":o(a,l(n,f[1],a[i].priority)),o(a,l(n,f[2],a[i].priority+1));break;case"splitstay":case"split":o(a,l(n,f[1],a[i].priority+1)),o(a,l(n,f[2],a[i].priority));break;case"jmp":o(a,l(n,f[1],a[i].priority));break;case"match":(null==d||d.end<k-1)&&(d={start:r,end:k-1,match:!0}),m=!0}if(0==p.length){if(null!=d)return d;i(n,a);break}i(n,a),a=p,p=[]}return d}function o(e,t){e.push(t);let r=e.length-1;for(let t=e.length-2;t>=0&&e[r].priority<e[t].priority;t--){let n=e[r];e[r]=e[t],e[t]=n,r=t}}function c(e,t){let r=t;return t.startsWith("[")?(r=t.substr(1,t.length-2),r=parseInt(r)+e):r=parseInt(r),r}self.importScripts("operators.js"),self.onmessage=function(l){let i=l.data,s=1,o=new Uint8Array(1);o[0]=255;let c=(p=o,(u=new(a=i.file).constructor(a.length+p.length)).set(a,0),u.set(p,a.length),u);var a,p,u;i.rules.forEach((function(l,o){try{let l=function(l,i,s){let o={strings:new Map,condition:[]},c=i.get(s);return"undefiend"!=typeof c.string&&function(l,i,s){let o=null;for(let e=0;e<l.length;e++)s.set(l[e].str_name.slice(1),[]);for(const c in l){let a=l[c],p=r(a.modifiers),u=null;"hex_exp_bytecode"==a.type||"regex_expression_bytecode"==a.type?u=a.val:"literal_string"==a.type&&(a.val=a.val.substr(1,a.val.length-2),u=t(a.val)),p.no_case&&e(u),p.ascii&&(o=n(i,u,p.no_case));let h=null;if(p.wide&&(h=n(i,u,p.no_case,!0)),null==o?o=h:null!=h&&o.push(...h),null!=o)for(let e=0;e<o.length;e++)s.get(a.str_name.slice(1)).push({string:a,start:o[e].start,end:o[e].end})}}(c.string,l,o.strings),"undefiend"!=typeof c.condition&&operators.eval_condition(l,c.condition,i,o),o}(c,i.rules,o);l.rule_name=o,l.hex_editor_id=i.hex_editor_id,l.completed_rules_count=s,l.active_rules_count=i.rules.size,self.postMessage(l)}catch(e){console.log(`Error processing: ${o}`)}s+=1}))}}worker={}})();