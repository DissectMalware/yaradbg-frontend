var worker;(()=>{if("function"==typeof importScripts){function e(e,t=!1){let r=[];e=(e=(e=(e=e.replaceAll("\\\\","\\")).replaceAll("\\n","\n")).replaceAll("\\r","\r")).replaceAll("\\t","\t");for(let n=0;n<e.length;n++)r.push(`chr ${e.charCodeAt(n).toString(16)}`),t&&r.push("chr 0");return r.push("match"),r}function t(e){let t={no_case:!1,ascii:!1,wide:!1};for(let r=0;r<e.length;r++)switch(e[r].modifier){case"nocase":t.no_case=!0;break;case"ascii":t.ascii=!0;break;case"wide":t.wide=!0}return 0==t.wide&&(t.ascii=!0),t}function r(e,t){let r=0,n=[],l=null,s=function(e){let t=[],r=e,n=!1,l=!1,i=null;for(let e=0;e<r.length;e++){if(i=r[e].split(/[ ,]/),"chr"==i[0])n=i[1].startsWith("?")?0:240,l=i[1].endsWith("?")?0:15,i[1]=parseInt(i[1].replace("?","0"),16),i.push(l|n);else if("chrc"==i[0])for(let e=1;e<i.length;e++)i[e]=parseInt(i[e],16);else"jmp"==i[0]?i[1]=o(e,i[1]):i[0].startsWith("split")?(i[1]=o(e,i[1]),i[2]=o(e,i[2])):"ignore"==i[0]&&(i[1]=parseInt(i[1]),i[2]=parseInt(i[2]));t.push(i)}return t}(t);"chr"==s[0][0]&&s[0][1];let a=[];for(let e=0;e<10;e++)a.push({pc:0,priority:0});let c=performance.now();for(;r<e.length;)l=i(e,s,r,a),null!=l?(r=l.start+1,n.push(l)):r+=1;return(performance.now()-c).toString(),n}function n(e,t,r){let n=null;return 0!=e.length?(n=e.pop(),n.pc=t,n.priority=r):n={pc:t,priority:r},n}function l(e,t){e.push(...t),t.length=0}function i(e,t,r,i){let o=[];o.push(n(i,0,0));let a=[],c=0,p=null,u=null,h=!1,f=null,g=[],d=null,y=!1;for(let _=r;_<e.length;_++){y=!1;for(let l=0;l<o.length&&0==y;l++)switch(c=o[l].pc,u=t[c],p=u[0],p){case"chr":if(h=0==u[2]||u[1]==(e[_]&u[2]),!1===h){if(0==g.length)break;d=g.pop(),_=d.end,c=d.ignore_loc,d.end-=1,d.start<=d.end&&g.push(d)}s(a,n(i,c+1,o[l].priority));break;case"chrc":let t=1+(e[_]>>3),p=1<<(7&e[_]);if(h=0!=(u[t]&p),!1===h){if(0==g.length)break;d=g.pop(),_=d.end,c=d.ignore_loc,d.end-=1,d.start<=d.end&&g.push(d)}a.push(n(i,c+1,o[l].priority));break;case"ignore":-1==u[2]&&(u[2]=e.length),g.push({start:_+u[1]-1,end:_+u[2]-1,ignore_loc:c}),_=_+u[1]-1,s(a,n(i,c+1,o[l].priority));break;case"splitjmp":s(o,n(i,u[1],o[l].priority)),s(o,n(i,u[2],o[l].priority+1));break;case"splitstay":case"split":s(o,n(i,u[1],o[l].priority+1)),s(o,n(i,u[2],o[l].priority));break;case"jmp":s(o,n(i,u[1],o[l].priority));break;case"match":(null==f||f.end<_-1)&&(f={start:r,end:_-1,match:!0}),y=!0}if(0==a.length){if(null!=f)return f;l(i,o);break}l(i,o),o=a,a=[]}return f}function s(e,t){e.push(t);let r=e.length-1;for(let t=e.length-2;t>=0&&e[r].priority<e[t].priority;t--){let n=e[r];e[r]=e[t],e[t]=n,r=t}}function o(e,t){let r=t;return t.startsWith("[")?(r=t.substr(1,t.length-2),r=parseInt(r)+e):r=parseInt(r),r}self.importScripts("operators.js"),self.onmessage=function(n){let l=n.data,i=1;l.rules.forEach((function(n,s){try{let n=function(n,l,i){let s={strings:new Map,condition:[]},o=l.get(i);return"undefiend"!=typeof o.string&&function(n,l,i){let s=null;for(let e=0;e<n.length;e++)i.set(n[e].str_name.slice(1),[]);for(const o in n){let a=n[o];if("hex_exp_bytecode"==a.type||"regex_expression_bytecode"==a.type){if(s=r(l,a.val),null!=s)for(let e=0;e<s.length;e++)i.get(a.str_name.slice(1)).push({string:a,start:s[e].start,end:s[e].end})}else if("literal_string"==a.type){let n=t(a.modifiers);if(a.val=a.val.substr(1,a.val.length-2),n.ascii&&(s=r(l,e(a.val))),n.wide){let t=e(a.val,!0);null==s?s=r(l,t):s.extend(r(l,t))}if(null!=s)for(let e=0;e<s.length;e++)i.get(a.str_name.slice(1)).push({string:a,start:s[e].start,end:s[e].end})}}}(o.string,n,s.strings),"undefiend"!=typeof o.condition&&operators.eval_condition(n,o.condition,l,s),s}(l.file,l.rules,s);n.rule_name=s,n.hex_editor_id=l.hex_editor_id,n.completed_rules_count=i,n.active_rules_count=l.rules.size,self.postMessage(n)}catch(e){console.log(`Error processing: ${s}`)}i+=1}))}}worker={}})();